#!/usr/bin/env python3\n\"\"\"\nAIMEX ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸\n\nSOLID ì›ì¹™:\n- SRP: ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ë§Œ ë‹´ë‹¹\n- OCP: ìƒˆë¡œìš´ ëª¨ë¸ ì¶”ê°€ ì‹œ ìë™ìœ¼ë¡œ í…Œì´ë¸” ìƒì„±\n- DIP: SQLAlchemy ì¶”ìƒí™” ê³„ì¸µ ì‚¬ìš©\n\nClean Architecture:\n- Infrastructure Layer: ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ ë° ì„¸ì…˜ ê´€ë¦¬\n- Domain Layer: ì—”í‹°í‹° ëª¨ë¸ ì •ì˜\n\"\"\"\n\nimport sys\nimport os\nfrom pathlib import Path\n\n# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œ ì¶”ê°€\nproject_root = Path(__file__).parent / \"backend\"\nsys.path.insert(0, str(project_root))\n\ntry:\n    from app.database import engine, test_database_connection\n    from app.models.base import Base\n    # ëª¨ë“  ëª¨ë¸ ì„í¬íŠ¸ (í…Œì´ë¸” ìƒì„±ì„ ìœ„í•´ í•„ìš”)\n    from app.models.user import User, Team, HFTokenManage, SystemLog\n    from app.models.influencer import (\n        ModelMBTI, StylePreset, AIInfluencer, \n        BatchKey, ChatMessage, InfluencerAPI, APICallAggregation\n    )\n    from app.models.board import Board\n    \n    def init_database():\n        \"\"\"\n        ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”\n        \n        Clean Architecture ì›ì¹™:\n        - ëª¨ë“  ë„ë©”ì¸ ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ í…Œì´ë¸” ìƒì„±\n        - ì¸í”„ë¼ ê³„ì¸µì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ ì‚¬ìš©\n        \"\"\"\n        print(\"ğŸ”§ AIMEX ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹œì‘...\")\n        \n        # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸\n        print(\"\\n1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸...\")\n        if not test_database_connection():\n            print(\"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨\")\n            print(\"\\ní•´ê²°ë°©ë²•:\")\n            print(\"- MySQL ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸\")\n            print(\"- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ í™•ì¸ (backend/.env)\")\n            print(\"- ë„¤íŠ¸ì›Œí¬ ë° ë°©í™”ë²½ ì„¤ì • í™•ì¸\")\n            return False\n        \n        print(\"âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ\")\n        \n        # í…Œì´ë¸” ìƒì„±\n        print(\"\\n2. í…Œì´ë¸” ìƒì„±...\")\n        try:\n            # ëª¨ë“  ëª¨ë¸ì˜ í…Œì´ë¸” ìƒì„±\n            Base.metadata.create_all(bind=engine)\n            print(\"âœ… í…Œì´ë¸” ìƒì„± ì™„ë£Œ\")\n            \n            # ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡ í™•ì¸\n            print(\"\\nğŸ“‹ ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡:\")\n            table_names = [\n                \"USER\", \"TEAM\", \"USER-TEAM\", \"HF_TOKEN_MANAGE\", \"SYSTEM_LOG\",\n                \"INFLUENCER_MBTI\", \"PRESET\", \"AI_INFLUENCER\", \"BATCH_KEY\",\n                \"CHAT_MESSAGE\", \"INFLUENCER_API\", \"API_CALL_AGGREGATION\", \"BOARD\"\n            ]\n            \n            for table_name in table_names:\n                print(f\"   âœ… {table_name}\")\n            \n            return True\n            \n        except Exception as e:\n            print(f\"âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: {e}\")\n            print(\"\\nê°€ëŠ¥í•œ ì›ì¸:\")\n            print(\"- í…Œì´ë¸”ì´ ì´ë¯¸ ì¡´ì¬í•˜ê³  ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¦„\")\n            print(\"- ë°ì´í„°ë² ì´ìŠ¤ ê¶Œí•œ ë¶€ì¡±\")\n            print(\"- ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ ì˜¤ë¥˜\")\n            import traceback\n            traceback.print_exc()\n            return False\n    \n    def drop_all_tables():\n        \"\"\"\n        ëª¨ë“  í…Œì´ë¸” ì‚­ì œ (ì£¼ì˜: ë°ì´í„° ì†ì‹¤ ë°œìƒ)\n        \n        ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥\n        \"\"\"\n        print(\"âš ï¸  ëª¨ë“  í…Œì´ë¸” ì‚­ì œ...\")\n        try:\n            Base.metadata.drop_all(bind=engine)\n            print(\"âœ… ëª¨ë“  í…Œì´ë¸” ì‚­ì œ ì™„ë£Œ\")\n            return True\n        except Exception as e:\n            print(f\"âŒ í…Œì´ë¸” ì‚­ì œ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    def reset_database():\n        \"\"\"\n        ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „ ì´ˆê¸°í™” (ì‚­ì œ í›„ ì¬ìƒì„±)\n        \n        ì£¼ì˜: ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!\n        \"\"\"\n        print(\"ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „ ì´ˆê¸°í™”...\")\n        \n        # ì‚¬ìš©ì í™•ì¸\n        confirm = input(\"âš ï¸  ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (yes/no): \")\n        if confirm.lower() not in ['yes', 'y']:\n            print(\"âŒ ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\")\n            return False\n        \n        # í…Œì´ë¸” ì‚­ì œ í›„ ì¬ìƒì„±\n        if drop_all_tables() and init_database():\n            print(\"ğŸ‰ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ!\")\n            return True\n        else:\n            print(\"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨\")\n            return False\n    \n    def check_tables():\n        \"\"\"\n        í˜„ì¬ í…Œì´ë¸” ìƒíƒœ í™•ì¸\n        \"\"\"\n        print(\"ğŸ“Š í…Œì´ë¸” ìƒíƒœ í™•ì¸...\")\n        \n        try:\n            from sqlalchemy import inspect\n            inspector = inspect(engine)\n            existing_tables = inspector.get_table_names()\n            \n            expected_tables = [\n                \"USER\", \"TEAM\", \"USER-TEAM\", \"HF_TOKEN_MANAGE\", \"SYSTEM_LOG\",\n                \"INFLUENCER_MBTI\", \"PRESET\", \"AI_INFLUENCER\", \"BATCH_KEY\",\n                \"CHAT_MESSAGE\", \"INFLUENCER_API\", \"API_CALL_AGGREGATION\", \"BOARD\"\n            ]\n            \n            print(f\"\\ní˜„ì¬ ì¡´ì¬í•˜ëŠ” í…Œì´ë¸”: {len(existing_tables)}ê°œ\")\n            for table in existing_tables:\n                status = \"âœ…\" if table in expected_tables else \"âš ï¸ \"\n                print(f\"   {status} {table}\")\n            \n            missing_tables = [t for t in expected_tables if t not in existing_tables]\n            if missing_tables:\n                print(f\"\\nëˆ„ë½ëœ í…Œì´ë¸”: {len(missing_tables)}ê°œ\")\n                for table in missing_tables:\n                    print(f\"   âŒ {table}\")\n            else:\n                print(\"\\nâœ… ëª¨ë“  ì˜ˆìƒ í…Œì´ë¸”ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\")\n            \n            return len(missing_tables) == 0\n            \n        except Exception as e:\n            print(f\"âŒ í…Œì´ë¸” ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    def main():\n        \"\"\"ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜\"\"\"\n        print(\"=\"*60)\n        print(\"ğŸ—ƒï¸  AIMEX ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ë„êµ¬\")\n        print(\"=\"*60)\n        \n        print(\"\\nì„ íƒí•  ì‘ì—…ì„ ì…ë ¥í•˜ì„¸ìš”:\")\n        print(\"1. í…Œì´ë¸” ìƒì„± (init)\")\n        print(\"2. í…Œì´ë¸” ìƒíƒœ í™•ì¸ (check)\")\n        print(\"3. ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „ ì´ˆê¸°í™” (reset)\")\n        print(\"4. ì¢…ë£Œ (exit)\")\n        \n        while True:\n            choice = input(\"\\nì‘ì—… ì„ íƒ (1-4): \").strip()\n            \n            if choice == '1' or choice.lower() == 'init':\n                success = init_database()\n                if success:\n                    print(\"\\nğŸ‰ í…Œì´ë¸” ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\")\n                    print(\"\\nğŸ“‹ ë‹¤ìŒ ë‹¨ê³„:\")\n                    print(\"   1. ì‹œë“œ ë°ì´í„° ìƒì„±: python create_seed_data.py\")\n                    print(\"   2. ì„œë²„ ì‹¤í–‰: cd backend && python run.py\")\n                break\n                \n            elif choice == '2' or choice.lower() == 'check':\n                check_tables()\n                break\n                \n            elif choice == '3' or choice.lower() == 'reset':\n                success = reset_database()\n                if success:\n                    print(\"\\nğŸ‰ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\")\n                    print(\"\\nğŸ“‹ ë‹¤ìŒ ë‹¨ê³„:\")\n                    print(\"   1. ì‹œë“œ ë°ì´í„° ìƒì„±: python create_seed_data.py\")\n                    print(\"   2. ì„œë²„ ì‹¤í–‰: cd backend && python run.py\")\n                break\n                \n            elif choice == '4' or choice.lower() == 'exit':\n                print(\"ğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.\")\n                break\n                \n            else:\n                print(\"âŒ ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤. 1-4 ì¤‘ì—ì„œ ì„ íƒí•˜ì„¸ìš”.\")\n        \n        return 0\n    \n    if __name__ == \"__main__\":\n        # ëª…ë ¹í–‰ ì¸ìˆ˜ê°€ ìˆëŠ” ê²½ìš° ì§ì ‘ ì‹¤í–‰\n        if len(sys.argv) > 1:\n            command = sys.argv[1].lower()\n            if command == 'init':\n                init_database()\n            elif command == 'check':\n                check_tables()\n            elif command == 'reset':\n                reset_database()\n            else:\n                print(f\"âŒ ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´: {command}\")\n                print(\"ì‚¬ìš©ë²•: python init_database.py [init|check|reset]\")\n        else:\n            # ëŒ€í™”í˜• ëª¨ë“œ\n            exit(main())\n        \nexcept ImportError as e:\n    print(f\"âŒ ëª¨ë“ˆ ì„í¬íŠ¸ ì˜¤ë¥˜: {e}\")\n    print(\"\\ní•´ê²°ë°©ë²•:\")\n    print(\"1. ê°€ìƒí™˜ê²½ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸\")\n    print(\"2. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜: pip install -r backend/requirements.txt\")\n    print(\"3. PYTHONPATH ì„¤ì • í™•ì¸\")\nexcept Exception as e:\n    print(f\"âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}\")\n    import traceback\n    traceback.print_exc()\n